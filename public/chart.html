<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: white;
    }

    .container {
      display: flex;
      align-items: center;
      gap: 80px;
      padding: 40px;
    }

    .chart-wrapper {
      width: 900px;
      height: 900px;
    }

    .legend {
      font-size: 22px;
      line-height: 1.6;
    }

    .back-btn {
      margin-top: 20px;
      padding: 14px 20px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #ef4444;
      color: white;
    }
  </style>
</head>
<body>

<div class="container">
  <div>
    <div class="chart-wrapper">
      <canvas id="chart"></canvas>
    </div>
    <button class="back-btn" onclick="location.href='index.html'">
      ‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é
    </button>
  </div>

  <div class="legend" id="legend"></div>
</div>

<script>
/**
 * üîí –ñ–Å–°–¢–ö–û –ó–ê–î–ê–ù–ù–´–ô –ü–û–†–Ø–î–û–ö
 * –ö–õ–Æ–ß–ò –ù–ò–ö–û–ì–î–ê –ù–ï –ú–ï–ù–Ø–Æ–¢–°–Ø
 */
const QUESTIONS = {
  q2: [
    { id: "9008969287733378", label: "VR-–ø—Å–∏—Ö–æ–ª–æ–≥" },
    { id: "1770033037788", label: "–ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç—Å–º–µ–Ω" },
    { id: "1770033025599", label: "–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä" },
    { id: "1770033059616", label: "–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥" }
  ]
};

const COLORS = ['#ff6384', '#36a2eb', '#ffcd56', '#4bc0c0'];

const params = new URLSearchParams(location.search);
const question = params.get('q');
if (!QUESTIONS[question]) location.href = 'index.html';

const config = QUESTIONS[question];
const labels = config.map(a => a.label);
const ids = config.map(a => a.id);

const ctx = document.getElementById('chart');
const chart = new Chart(ctx, {
  type: 'pie',
  data: {
    labels,
    datasets: [{
      data: new Array(ids.length).fill(0),
      backgroundColor: COLORS
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    animation: false,
    plugins: {
      legend: { display: false }
    }
  }
});

async function update() {
  const res = await fetch(`/api/stats?q=${question}`);
  const stats = await res.json();

  const values = ids.map(id => Number(stats[id] || 0));
  chart.data.datasets[0].data = values;
  chart.update('none');

  const total = values.reduce((a,b)=>a+b,0) || 1;
  document.getElementById('legend').innerHTML =
    labels.map((l,i)=>`
      <div>
        <span style="color:${COLORS[i]}">‚ñ†</span>
        ${l}: ${((values[i]/total)*100).toFixed(1)}%
      </div>
    `).join('');
}

update();
setInterval(update, 1000); // ‚úÖ –ø–ª–∞–≤–Ω–æ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ
</script>

</body>
</html>
