<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: white;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      display: flex;
      align-items: center;
      gap: 48px;
      max-width: 1200px;
      width: 100%;
      padding: 40px;
      box-sizing: border-box;
    }

    /* ‚¨ÜÔ∏è –£–í–ï–õ–ò–ß–ï–ù–ù–´–ô –ë–õ–û–ö –ü–û–î –î–ò–ê–ì–†–ê–ú–ú–£ */
    .chart-wrapper {
      width: 700px;
      height: 700px;
    }

    canvas {
      width: 100% !important;
      height: 100% !important;
    }

    .legend {
      font-size: 16px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 14px;
      line-height: 1.3;
    }

    .legend-color {
      width: 14px;
      height: 14px;
      border-radius: 4px;
      margin-right: 10px;
      flex-shrink: 0;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="chart-wrapper">
    <canvas id="chart"></canvas>
  </div>
  <div id="legend" class="legend"></div>
</div>

<script>
  // üîπ –ú–ê–ü–ü–ò–ù–ì –ö–û–î–û–í ‚Üí –¢–ï–ö–°–¢ –û–¢–í–ï–¢–û–í
  const ANSWER_LABELS = {
    "1770032780082": "–¢—Ä–µ–Ω–µ—Ä –ò–ò",
    "1770032788433": "–ê—Ä—Ö–µ–æ–ª–æ–≥",
    "9008969287495770": "–î–∏–∑–∞–π–Ω–µ—Ä –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤",
    "1770032798666": "–õ–∏–Ω–≥–≤–∏—Å—Ç"
  }

  const COLORS = [
    "#FF6384",
    "#36A2EB",
    "#FFCE56",
    "#4BC0C0",
    "#9966FF"
  ]

  async function loadStats() {
    const res = await fetch("/api/stats")
    const stats = await res.json()

    const entries = Object.entries(stats)
    const total = entries.reduce((sum, [, count]) => sum + count, 0)

    const labels = entries.map(([key]) => ANSWER_LABELS[key] ?? key)
    const values = entries.map(([, count]) => count)

    new Chart(document.getElementById("chart"), {
      type: "pie",
      data: {
        labels,
        datasets: [{
          data: values,
          backgroundColor: COLORS
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        }
      }
    })

    const legend = document.getElementById("legend")
    legend.innerHTML = ""

    entries.forEach(([key, count], index) => {
      const percent = ((count / total) * 100).toFixed(1)

      legend.innerHTML += `
        <div class="legend-item">
          <div class="legend-color" style="background:${COLORS[index]}"></div>
          ${ANSWER_LABELS[key] ?? key}: ${percent}%
        </div>
      `
    })
  }

  loadStats()
</script>

</body>
</html>
