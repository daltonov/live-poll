<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: white;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      display: flex;
      align-items: center;
      gap: 40px;
    }

    canvas {
      width: 320px !important;
      height: 320px !important;
    }

    .legend {
      font-size: 14px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      margin-right: 8px;
      flex-shrink: 0;
    }
  </style>
</head>
<body>

<div class="container">
  <canvas id="chart"></canvas>
  <div id="legend" class="legend"></div>
</div>

<script>

  const ANSWER_LABELS = {
    "1770032780082": "–¢—Ä–µ–Ω–µ—Ä –ò–ò",
    "1770032788433": "–ê—Ä—Ö–µ–æ–ª–æ–≥",
    "9008969287495770": "–î–∏–∑–∞–π–Ω–µ—Ä –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤",
    "1770032798666": "–õ–∏–Ω–≥–≤–∏—Å—Ç"
  }

  const COLORS = [
    "#FF6384",
    "#36A2EB",
    "#FFCE56",
    "#4BC0C0",
    "#9966FF"
  ]

  async function loadStats() {
    const res = await fetch("/api/stats")
    const stats = await res.json()

    const entries = Object.entries(stats)
    const total = entries.reduce((sum, [, count]) => sum + count, 0)

    const labels = entries.map(([key]) => ANSWER_LABELS[key] ?? key)
    const values = entries.map(([, count]) => count)

    // üéØ –ö–†–£–ì–û–í–ê–Ø –î–ò–ê–ì–†–ê–ú–ú–ê
    new Chart(document.getElementById("chart"), {
      type: "pie",
      data: {
        labels,
        datasets: [{
          data: values,
          backgroundColor: COLORS
        }]
      },
      options: {
        plugins: {
          legend: {
            display: false // ‚ùå –æ—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ª–µ–≥–µ–Ω–¥—É —Å–≤–µ—Ä—Ö—É
          }
        }
      }
    })

    // üìä –ö–ê–°–¢–û–ú–ù–ê–Ø –õ–ï–ì–ï–ù–î–ê –°–ü–†–ê–í–ê
    const legend = document.getElementById("legend")
    legend.innerHTML = ""

    entries.forEach(([key, count], index) => {
      const percent = ((count / total) * 100).toFixed(1)

      legend.innerHTML += `
        <div class="legend-item">
          <div class="legend-color" style="background:${COLORS[index]}"></div>
          ${ANSWER_LABELS[key] ?? key}: ${percent}%
        </div>
      `
    })
  }

  loadStats()
</script>

</body>
</html>
